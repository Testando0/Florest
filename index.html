<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Imagens com Cloudflare Workers AI</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #prompt { width: 80%; height: 100px; margin: 20px auto; display: block; }
        #generateBtn { padding: 10px 20px; font-size: 16px; }
        #imageContainer { margin: 20px auto; max-width: 800px; }
        #generatedImage { max-width: 100%; height: auto; }
        #status { color: red; }
    </style>
</head>
<body>
    <h1>Gerador de Imagens 100% Fiel ao Texto</h1>
    <p>Insira um prompt detalhado para garantir 100% de fidelidade à descrição. Exemplo: "Uma paisagem montanhosa ao pôr do sol, com um lago calmo e árvores antigas, estilo fotorrealista, alta resolução, sem adições extras."</p>
    <textarea id="prompt" placeholder="Digite o prompt aqui..."></textarea>
    <button id="generateBtn">Gerar Imagem</button>
    <div id="imageContainer">
        <img id="generatedImage" src="" alt="Imagem Gerada">
    </div>
    <p id="status"></p>

    <script>
        const accountId = 'EZnH74dXipNmuwQOtCAcW1oLQzJ5oKbTnpgBqJUI'; // Substitua pelo seu Account ID da Cloudflare
        const apiToken = '648085ab1193eeacc92d058d278a0d83'; // Substitua pelo seu API Token da Cloudflare
        const model = '@cf/black-forest-labs/flux-2-dev'; // Modelo mais fiel ao texto
        const proxyUrl = 'https://corsproxy.io/?'; // Proxy CORS para contornar restrições

        document.getElementById('generateBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('prompt').value.trim();
            const status = document.getElementById('status');
            const generatedImage = document.getElementById('generatedImage');

            if (!prompt) {
                status.textContent = 'Por favor, insira um prompt válido.';
                return;
            }

            status.textContent = 'Gerando imagem...';
            generatedImage.src = ''; // Limpa imagem anterior

            try {
                const apiUrl = `https://api.cloudflare.com/client/v4/accounts/\( {accountId}/ai/run/ \){model}`;
                const response = await fetch(proxyUrl + encodeURIComponent(apiUrl), {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: prompt }) // Envia o prompt para fidelidade 100%
                });

                if (!response.ok) {
                    throw new Error(`Erro: ${response.status} - ${response.statusText}`);
                }

                const blob = await response.blob();
                const imageUrl = URL.createObjectURL(blob);
                generatedImage.src = imageUrl;
                status.textContent = 'Imagem gerada com sucesso!';
            } catch (error) {
                status.textContent = `Erro ao gerar imagem: ${error.message}`;
                console.error(error);
            }
        });
    </script>
</body>
</html>
